# deserialize JsonUnwrapped with jackson ObjectMapper

receiving the error
```text
com.fasterxml.jackson.databind.exc.InvalidDefinitionException: Cannot define Creator property "location" as `@JsonUnwrapped`: combination not yet supported
```
means you misconfigured `@JsonUnwrapped` in your Java file.

## TL;DR
deserialization of a field with `@JsonUnwrapped` reliably works
* for mutable classes that have **setter** and a **no args constructor**
* when you set the unwrapped field to `READ_ONLY`

## motivation for JsonUnwrapped
You might want to have a *plain* JSON
```json
{
   "name":"John",
   "x":"1",
   "y":"2"
}
```
but in your code you want to have more structure
```java
class MyJson {
    private String name;
    private Location location;
}
```
You can tell jackson `ObjectMapper` to unwrap this
```java
import com.fasterxml.jackson.annotation.JsonUnwrapped;

class MyJson {
    private String name;
    @JsonUnwrapped
    private Location location;
}
```
That should be enough. But there are several issues you might discover:

## an explicit constructor with @JsonCreator and @JsonProperty
see [Unwrapping1.java](src/main/java/com/mercateo/Unwrapping1.java)
```java
    @JsonCreator
    public Unwrapping1(@JsonProperty("name") String name, @JsonProperty("location") Location location) {
```
This succeeds for jackson version `2.8.10`, but fails for `2.11.1` with `@JsonUnwrapped`: combination not yet supported. Not *yet* supported, huh?

## an explicit constructor with @JsonCreator and @JsonProperty and @JsonUnwrapped
see [Unwrapping4.java](src/main/java/com/mercateo/Unwrapping4.java)
```java
    @JsonCreator
    public Unwrapping4(@JsonProperty("name") String name, @JsonUnwrapped Location location) {
```
same as `@JsonProperty` instead of `@JsonUnwrapped`: Succeeds for `2.8.10`, but fails for `2.11.1` with *combination not yet supported*.

## an explicit constructor with @ConstructorProperties
see [Unwrapping2.java](src/main/java/com/mercateo/Unwrapping2.java), this is what [Lombok](https://projectlombok.org/) will produce for you when you use `@Value` or `@Data`
```java
    @java.beans.ConstructorProperties({ "name", "location" })
    public Unwrapping2(String name, Location location) {
```
Unfortunately this fails for `2.8.10` and `2.11.1`.

## READ_ONLY at @JsonUnwrapped field
see [Unwrapping5.java](src/main/java/com/mercateo/Unwrapping5.java), setter and getter are generated by [Lombok](https://projectlombok.org/)
```java
    @JsonUnwrapped
    @JsonProperty(access = JsonProperty.Access.READ_ONLY)
    @Getter
    private Location location;

    @JsonCreator
    public Unwrapping5(@JsonProperty("name") String name, @JsonProperty("location") Location location) {
```
This **succeeds** for `2.8.10` and `2.11.1` because the "bug" in `ObjectMapper` is that the unwrapped value is set twice. When you set the field to `READ_ONLY`, it is set only once.

## mutable fields with setter and no (args) constructor
see [Unwrapping3.java](src/main/java/com/mercateo/Unwrapping3.java), setter and getter are generated by [Lombok](https://projectlombok.org/)
```java
class Unwrapping3 {
    @Getter
    @Setter
    private String name;

    @JsonUnwrapped
    @Getter
    @Setter
    private Location location;
```
This **succeeds** for `2.8.10` and `2.11.1`. The downside is that this class is highly mutable.

## further readings
1. [Jackson Annotation Examples](https://www.baeldung.com/jackson-annotations#3-jsonunwrapped)
1. [Jackson JSON - Using @JsonUnwrapped to serialize/deserialize properties as flattening data structure](https://www.logicbig.com/tutorials/misc/jackson/json-unwrapped.html)
1. [deserialize @JsonUnwrapped example provided by jackson](https://github.com/FasterXML/jackson-databind/blob/d2c083a6220f2875c97c29f4823d9818972511dc/src/test/java/com/fasterxml/jackson/databind/struct/TestUnwrapped.java#L138)
1. [Do not try to set @JsonUnwrapped fields if using a @JsonCreator constructor](https://github.com/FasterXML/jackson-databind/issues/1497)
1. [Support `@JsonUnwrapped` with `@JsonCreator` (if possible)](https://github.com/FasterXML/jackson-databind/issues/1467)
1. [Java Code Examples for com.fasterxml.jackson.annotation.JsonProperty.Access](https://www.programcreek.com/java-api-examples/index.php?api=com.fasterxml.jackson.annotation.JsonProperty.Access)
